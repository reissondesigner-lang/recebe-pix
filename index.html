<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Receber Pix</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>

body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  margin:0;
}

header{
  background:#136b2b;
  padding:18px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.container{padding:20px;max-width:520px;margin:auto}

.card{
  background:#1e293b;
  padding:20px;
  border-radius:14px;
}

input{
  width: calc(100% - 28px);
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:8px;
  background:#0f172a;
  color:white;
  font-size:18px;
  text-align:center;
}

button{
  width:100%;
  padding:16px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#136b2b;
  color:white;
  font-size:18px;
  cursor:pointer;
  font-weight: bold;
}

#qrcode {display: flex; justify-content: center; margin-top: 20px; }


textarea{
  width: calc(100% - 24px);
  height:110px;
  margin-top:15px;
  background:#0f172a;
  color:white;
  border:none;
  border-radius:8px;
  padding:12px;
  resize: none;
}
</style>
</head>

<body>

<header>üè¶ Pix RD Flex</header>

<div class="container">

<div class="card">

<h3 style="text-align:center">Digite o valor</h3>

<input id="valor" placeholder="R$ 0,00" type="text" inputmode="numeric" autocomplete="off" autocorrect="off" spellcheck="false">

<button onclick="gerar()">GERAR PIX</button>

<div id="qrcode"></div>

<textarea id="resultado" readonly></textarea>

<button onclick="copiar()">COPIAR PIX</button>

</div>

</div>

<script>
// DADOS DA SUA CONTA
const CHAVE="54162152000110";
const NOME="REISSON DOS S E SANTOS";
const CIDADE="SANTO ANTONIO";

function emv(id,value){return id+value.length.toString().padStart(2,"0")+value;}

function crc16(payload){
 let crc=0xFFFF;
 for(let i=0;i<payload.length;i++){
  crc^=payload.charCodeAt(i)<<8;
  for(let j=0;j<8;j++){
   crc=(crc&0x8000)?(crc<<1)^0x1021:crc<<1;
  }
 }
 return (crc&0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

const inputValor = document.getElementById("valor");

inputValor.addEventListener("input", (e) => {
  let valor = e.target.value;

  // Remove tudo que n√£o √© n√∫mero
  valor = valor.replace(/\D/g, "");

  // Transforma em n√∫mero e divide por 100 para ter centavos
  valor = (valor / 100).toFixed(2);

  // Formata como moeda BR
  e.target.value = new Intl.NumberFormat("pt-BR", {
    style: "currency",
    currency: "BRL"
  }).format(valor);
});

  
function gerar(){

 let valorInput=document.getElementById("valor").value;
valorInput = valorInput.replace(/\D/g, ""); // remove tudo que n√£o √© n√∫mero
valorInput = (parseInt(valorInput)/100).toFixed(2);
  
 if(!valorInput){
   alert("Digite o valor!");
   return;
 }

 let valor=emv("54",parseFloat(valorInput).toFixed(2));

 let gui=emv("00","BR.GOV.BCB.PIX");
 let chaveField=emv("01",CHAVE);
 let conta=emv("26",gui+chaveField);

 let adicional="62070503***";

 let payload=
 "000201"+
 "010211"+
 conta+
 "52040000"+
 "5303986"+
 valor+
 "5802BR"+
 emv("59",NOME)+
 emv("60",CIDADE)+
 adicional+
 "6304";

 payload+=crc16(payload);

 document.getElementById("resultado").value=payload;

 gerarQR(payload);
}

function gerarQR(texto){
 document.getElementById("qrcode").innerHTML="";
 new QRCode(document.getElementById("qrcode"),{
  text:texto,width:220,height:220
 });
}

function copiar(){
 let campo=document.getElementById("resultado");
 campo.select();
 document.execCommand("copy");
 alert("Pix copiado!");
}

if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>

</body>
  </html>
