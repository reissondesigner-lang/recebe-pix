<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Receber Pix</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#136b2b">

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>

body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  margin:0;
}

header{
  background:#136b2b;
  padding:18px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.container{padding:20px;max-width:520px;margin:auto}

.card{
  background:white;
  color:#0f172a;
  padding:28px 22px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.25);
}

.title{
  text-align:center;
  margin:0;
  font-size:22px;
  color:#136b2b;
}

.subtitle{
  text-align:center;
  margin:6px 0 22px;
  font-size:14px;
  opacity:.7;
}

input{
  width: calc(100% - 28px);
  padding:14px;
  margin:10px 0;
  border: 2px solid #ddd;
  border-radius:8px;
  background:#f1f5f9;
  color:#0f172a;
  font-weight:bold;
  font-size:18px;
  text-align:center;
}

button{
  width:100%;
  padding:16px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#136b2b;
  color:white;
  font-size:18px;
  cursor:pointer;
  font-weight: bold;
  transition:all .2s ease;
}

button:active{
  transform:scale(.97);
}

button:disabled{
  opacity:.5;
  cursor:not-allowed;
}

#qrcode{
  display:flex;
  justify-content:center;
  margin:30px 0 10px;
  opacity:0;
  transform:scale(.9);
  transition:.3s ease;
}

#qrcode.show{
  opacity:1;
  transform:scale(1);
}

textarea{
  width: calc(100% - 24px);
  height:110px;
  margin-top:15px;
  background:#f1f5f9;
  color:#0f172a;
  border:2px solid #ddd;
  border-radius:8px;
  padding:12px;
  resize: none;
}
</style>
</head>

<body>

<header>üè¶ Pix RD Flex</header>

<div class="container">

<div class="card">

<h2 class="title">Receber via Pix</h2>
<p class="subtitle">Digite o valor da cobran√ßa</p>

<input id="valor" placeholder="R$ 0,00" type="text"
inputmode="numeric" autocomplete="off" autocorrect="off" spellcheck="false">

<button id="btnGerar" onclick="gerar()" disabled>
üí∞ GERAR PIX
</button>

<div id="qrcode"></div>

<textarea id="resultado" readonly></textarea>

<button id="btnCopiar" onclick="copiar()">
üìã COPIAR PIX
</button>

</div>

</div>

<script>
// DADOS DA SUA CONTA
const CHAVE="cbd7ea13-743d-483e-bacb-18d459ea9d18";
const NOME="REISSON DOS S E SANTOS";
const CIDADE="SANTO ANTONIO";

function emv(id,value){return id+value.length.toString().padStart(2,"0")+value;}

function crc16(payload){
 let crc=0xFFFF;
 for(let i=0;i<payload.length;i++){
  crc^=payload.charCodeAt(i)<<8;
  for(let j=0;j<8;j++){
   crc=(crc&0x8000)?(crc<<1)^0x1021:crc<<1;
  }
 }
 return (crc&0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

const inputValor = document.getElementById("valor");

inputValor.addEventListener("input", (e) => {

  let valor = e.target.value.replace(/\D/g, "");

  let numero = parseInt(valor || 0) / 100;

  document.getElementById("btnGerar").disabled = !(numero > 0.01);

  valor = (numero).toFixed(2);

  e.target.value = new Intl.NumberFormat("pt-BR", {
    style: "currency",
    currency: "BRL"
  }).format(valor);

});

inputValor.addEventListener("keypress",e=>{
 if(e.key==="Enter" && !document.getElementById("btnGerar").disabled){
   gerar();
 }
});
  
function gerar(){
if(navigator.vibrate) navigator.vibrate(30);
 let valorInput=document.getElementById("valor").value;
valorInput = valorInput.replace(/\D/g, ""); // remove tudo que n√£o √© n√∫mero
valorInput = (parseInt(valorInput || 0)/100).toFixed(2);
  
 if(parseFloat(valorInput) <= 0.01){
   return;
}

 let valor=emv("54",parseFloat(valorInput).toFixed(2));

 let gui=emv("00","BR.GOV.BCB.PIX");
 let chaveField=emv("01",CHAVE);
 let conta=emv("26",gui+chaveField);

 let adicional="62070503***";

 let payload=
 "000201"+
 "010211"+
 conta+
 "52040000"+
 "5303986"+
 valor+
 "5802BR"+
 emv("59",NOME)+
 emv("60",CIDADE)+
 adicional+
 "6304";

 payload+=crc16(payload);

 document.getElementById("resultado").value=payload;

 gerarQR(payload);
document.getElementById("qrcode").scrollIntoView({behavior:"smooth"});
}

function gerarQR(texto){
 const qr = document.getElementById("qrcode");
 qr.classList.remove("show");
 qr.innerHTML="";
 
 new QRCode(qr,{
  text:texto,width:220,height:220
 });

 setTimeout(()=>qr.classList.add("show"),50);
}

function copiar(){
 if(navigator.vibrate) navigator.vibrate(30);

 let campo=document.getElementById("resultado");
 navigator.clipboard.writeText(campo.value);

 let btn=document.getElementById("btnCopiar");
 btn.innerText="‚úÖ COPIADO!";
 setTimeout(()=>btn.innerText="üìã COPIAR PIX",1500);
}

if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>

</body>
  </html>
